# DualRNASeq Analysis Pipeline  

### Author: Jash Trivedi, MS Biotechnology, University of Central Florida  

---  

## **Overview**  

The DualRNASeq Analysis Pipeline is a robust bioinformatics workflow designed for the analysis of host-pathogen dual RNA sequencing (DualRNASeq) data. This pipeline processes paired-end RNA-Seq data to explore transcriptional responses in host and pathogen during infection. The workflow covers essential steps including preprocessing, alignment, contamination screening, quality control, and gene quantification.  

With a modular structure, the pipeline ensures flexibility and scalability, allowing users to adapt it to their specific projects. Each module is implemented as a separate Snakefile for ease of maintenance and debugging, and configurations are centralized in a single `config.yaml` file.  

This pipeline has been effectively utilized in a serotype 3 *Streptococcus pneumoniae* (SPN) project aimed at unraveling the complexities of host-pathogen interactions during infection. By analyzing dual RNA-Seq data from mice infected with clade I and clade II strains of serotype 3 SPN, the study identified distinct transcriptional responses in both the host and pathogen. The investigation revealed critical insights into the expression of accessory genes, patterns of transcriptional dysregulation, and clade-specific virulence factors, providing a deeper and more nuanced understanding of SPN pathogenicity.  

---  

## **Key Features**  

- **Flexible Input Handling**: Automatically detects paired-end FASTQ files in the data directory.  
- **Data Preprocessing**: Includes trimming of low-quality reads and adapters using `fastp`.  
- **Alignment**: Supports alignment to both host and pathogen reference genomes using `STAR & Bowtie2`.  
- **Contamination Screening**: Screens unmapped reads for bacterial contamination using `Kraken2`.  
- **Quality Control**: Performs quality checks using `FastQC` and `Qualimap`, with summary reports generated by `MultiQC`.  
- **Gene Quantification**: Quantifies gene expression levels using `htseq-count` for both host and pathogen.  
- **Benchmarking**: Tracks runtime and resource usage for each pipeline rule, aiding in optimization.  
- **Comprehensive Reporting**: Combines all QC and analysis outputs into a single MultiQC report.  

---  

## **Pipeline Workflow**  

### **1. Preprocessing**  
- **Input**: Paired-end FASTQ files (`sample_1.fastq.gz`, `sample_2.fastq.gz`)  
- **Tools**: `fastp`, `FastQC`  
- **Output**: Trimmed FASTQ files, quality reports  

### **2. Alignment**  
- **Input**: Trimmed FASTQ files  
- **Tools**: `STAR & Bowtie2`  
- **Output**: sorted BAM files (aligned and unmapped reads)  

### **3. Alignment Quality Control**  
- **Input**: BAM files  
- **Tools**: `Qualimap`  
- **Output**: Alignment QC metrics  

### **4. Contamination Screening**  
- **Input**: Unmapped reads from host alignment  
- **Tools**: `Kraken2`  
- **Output**: Contamination reports  

### **5. Gene Quantification**  
- **Input**: BAM files  
- **Tools**: `htseq-count`  
- **Output**: Gene expression matrices for host and pathogen  

### **6. MultiQC Reporting**  
- **Input**: Outputs from trimming, alignment QC, Kraken2, and other QC steps  
- **Tools**: `MultiQC`  
- **Output**: Consolidated MultiQC HTML report  

---  

## **Setup and Usage**  

### **1. Prerequisites**  
- `Snakemake`  
- `Conda` (for environment management)  

### **2. Clone the Repository**  
```bash  
git clone <repository_url>  
cd project_root  
```  

### **3. Configure the Pipeline**  
Edit the `config/config.yaml` file to specify:  
- Paths to input data and reference files.  
 
### **4. Run the `setup.sh` Script**  
Execute the setup script to install `Snakemake` and its dependencies:  
```bash  
bash setup.sh  
```  

The script performs the following:  
1. Installs Miniconda if not already available.  
2. Configures a Conda environment for Snakemake.  
3. Installs Snakemake and its dependencies into the environment.  

### **5. Create Conda Environments**  
Install all Conda environments required for the pipeline:  
```bash  
snakemake --use-conda --create-envs-only  
```  

### **6. Execute the Pipeline**  
Run the pipeline on all samples:  
```bash  
snakemake --sdm conda --cores <number_of_cores>  
```  

---  

## **Benchmarking**  

Each rule in the pipeline incorporates Snakemake’s `benchmark` feature, allowing runtime and resource usage to be tracked in `.txt` files stored in the `logs/` directory. These files provide critical information for performance tuning and optimization.  

---  

## **Memory Allocation Optimization**  

Memory usage can vary depending on the size of your input data. To optimize performance:  

1. Edit the `config/config.yaml` file and adjust the `mem_mb` parameter for specific rules.  
2. Use benchmarking results to identify rules requiring additional memory or compute resources.  

---  

## **Directory Structure**  

```plaintext  
project_root/
├── config/                        # Configuration files
│   └── config.yaml                # Centralized configuration file
├── data/                          # Input data (raw FASTQ files)
├── references/                    # Reference genome and annotation files
├── rules/                         # Individual Snakefiles for pipeline steps
│   ├── get_data.smk
│   ├── preprocessing.smk
│   ├── alignment.smk
│   ├── alignment_qc.smk
│   ├── kraken_screening.smk
│   ├── gene_quantification.smk
│   └── multiqc.smk
├── environments/                  # Conda environments for reproducibility
│   ├── fastqc.yaml
│   ├── fastp.yaml
│   ├── star.yaml
│   ├── bowtie2.yaml
│   ├── multiqc.yaml
│   ├── kraken2.yaml
│   ├── htseq-count.yaml
│   └── qualimap.yaml
|
└── Snakefile                      # Main pipeline file

```  

---  

## **Contact Information**  

For questions or support, please contact:  
**Jash Trivedi**  
- Email: jashtrivedi221@gmail.com  
- GitHub: [https://github.com/J22160](https://github.com/J22160)  

---  

## **Acknowledgments**  

This pipeline incorporates multiple open-source tools and is made possible by the contributions of the bioinformatics community. Special thanks to the developers of Snakemake and the individual tools used in this workflow.  

---
```
